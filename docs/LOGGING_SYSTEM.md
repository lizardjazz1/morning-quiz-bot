# Система логирования Morning Quiz Bot

## Обзор

Бот использует многоуровневую систему логирования с автоматической ротацией и очисткой.

## Структура файлов логов

### Папка `logs/`
Все логи сохраняются в папку `logs/` с timestamp в имени файла:

```
logs/
├── bot_20250825_213000.log    # Текущий лог
├── bot_20250825_213000.log.1  # Бэкап 1 (10 MB)
├── bot_20250825_213000.log.2  # Бэкап 2 (10 MB)
├── bot_20250825_213000.log.3  # Бэкап 3 (10 MB)
├── bot_20250825_213000.log.4  # Бэкап 4 (10 MB)
└── bot_20250825_213000.log.5  # Бэкап 5 (10 MB)
```

### Формат имени файла
- **Шаблон**: `bot_YYYYMMDD_HHMMSS.log`
- **Пример**: `bot_20250825_213000.log` (25 августа 2025, 21:30:00)

## Настройки ротации

- **Максимальный размер файла**: 10 MB
- **Количество бэкапов**: 5 файлов
- **Кодировка**: UTF-8
- **Формат**: `%(asctime)s - %(name)s - %(levelname)s - %(message)s`

## Автоматическая очистка

### 1. Ротация логов ✅
- Автоматическое создание нового файла при достижении 10 MB
- Сохранение 5 предыдущих версий
- Каждый запуск бота создает новый файл с timestamp

### 2. Очистка сообщений бота ✅
- **PRODUCTION режим**: каждые 6 часов
- **TESTING режим**: каждую минуту
- Удаление старых сообщений из `bot_state.generic_messages_to_delete`

### 3. Очистка сообщений викторин ✅
- Сообщения викторин: через 5 минут
- Решения опросов: через 2 минуты
- Меню настройки: через 5 минут

## Уровни логирования

- **DEBUG**: Детальная отладочная информация
- **INFO**: Общая информация о работе бота
- **WARNING**: Предупреждения
- **ERROR**: Ошибки
- **CRITICAL**: Критические ошибки

## Настройка режимов

### Переменная окружения `MODE`
- **`production`** (по умолчанию): уровень INFO, очистка каждые 6 часов
- **`testing`**: уровень DEBUG, очистка каждую минуту

### Пример .env
```env
MODE=production
LOG_LEVEL=INFO
```

## Мониторинг

### Проверка размера логов
```bash
# Размер папки logs
du -sh logs/

# Размер отдельных файлов
ls -lh logs/
```

### Просмотр последних записей
```bash
# Последние 100 строк текущего лога
tail -100 logs/bot_*.log | grep -v "bot_"

# Поиск ошибок
grep -i "error\|critical\|exception" logs/bot_*.log
```

## Рекомендации

1. **Регулярно проверяйте размер папки `logs/`**
2. **Настройте мониторинг критических ошибок**
3. **В продакшене используйте `MODE=production`**
4. **Для отладки используйте `MODE=testing`**

## Устранение неполадок

### Логи не создаются
- Проверьте права на запись в папку `logs/`
- Убедитесь, что импортирован `logging.handlers`

### Файлы не ротируются
- Проверьте размер файлов: `ls -lh logs/`
- Убедитесь, что `maxBytes` и `backupCount` настроены правильно

### Очистка не работает
- Проверьте переменную `MODE` в `.env`
- Убедитесь, что `schedule_cleanup_job` вызывается в `bot.py`
