# Отображение достижений (ачивок) пользователей

## 📋 Резюме
Документация по отображению достижений пользователей в веб-панели.

---

## 🎖️ ТИПЫ ДОСТИЖЕНИЙ

### 1. 🏆 Чатовые достижения (Chat Achievements)
**Формат ID:** `chat_achievement_{chat_id}_{user_id}_{score}`

**Описание:** Получаются за достижение определенного количества очков в конкретном чате.

**Примеры:**
- `chat_achievement_-4239123712_816474830_1000` → "Достижение чата: 1000 очков"
- `chat_achievement_-4239123712_816474830_500` → "Достижение чата: 500 очков"

**Отображение:**
- Иконка: 🏆
- Цвет: Зеленый (success)
- Показывает: количество очков и название чата

---

### 2. ⭐ Мотивационные достижения (Motivational Achievements)
**Формат ID:** 
- `motivational_{chat_id}_{user_id}_{count}` (в конкретном чате)
- `motivational_{user_id}_{count}` (глобальное)

**Описание:** Получаются за определенное количество правильных ответов.

**Примеры:**
- `motivational_-4239123712_816474830_300` → "Мотивационное: 300 ответов (в чате)"
- `motivational_816474830_300` → "Мотивационное: 300 ответов (глобально)"

**Отображение:**
- Иконка: ⭐
- Цвет: Синий (primary)
- Показывает: количество ответов и scope (чат/глобально)

---

### 3. 🔥 Достижения за серию (Streak Achievements)
**Формат ID:** `*_streak_{count}` или похожие

**Описание:** Получаются за серию правильных ответов подряд.

**Примеры:**
- Серия из 50 правильных ответов подряд
- Серия из 10 правильных ответов подряд

**Отображение:**
- Иконка: 🔥
- Цвет: Оранжевый (warning)
- Показывает: длину серии

**Сообщения для серий** хранятся в `data/system/streak_achievements.json` с разными вариантами текста для каждой длины серии (3, 4, 5, ..., 50).

---

## 📊 ГДЕ ХРАНЯТСЯ ДОСТИЖЕНИЯ

### В данных пользователя

**1. В `data/chats/{chat_id}/users.json`:**
```json
{
  "user_id": {
    "name": "Username",
    "score": 1663.3,
    "milestones_achieved": [
      "chat_achievement_-4239123712_816474830_1000",
      "motivational_-4239123712_816474830_300",
      "motivational_816474830_300"
    ]
  }
}
```

**2. В `data/global/users.json`:**
```json
{
  "user_id": {
    "name": "Username",
    "global_score": 1663.3,
    "milestones_achieved": [
      "motivational_816474830_300",
      "chat_achievement_-4239123712_816474830_1000"
    ]
  }
}
```

---

## 🌐 API ENDPOINT

### GET `/api/users/{user_id}`

**Ответ:**
```json
{
  "user_id": "816474830",
  "name": "Анна",
  "total_score": 1663.3,
  "total_answered": 498,
  "max_streak": 15,
  "achievements": [
    {
      "type": "streak",
      "icon": "🔥",
      "title": "Серия: 15 подряд",
      "description": "Серия из 15 правильных ответов подряд",
      "chat_id": "-4239123712",
      "chat_title": "Название чата"
    },
    {
      "type": "chat",
      "icon": "🏆",
      "title": "Достижение чата: 1000 очков",
      "description": "Набрано 1000 баллов в чате",
      "chat_id": "-4239123712",
      "chat_title": "Название чата"
    },
    {
      "type": "motivational",
      "icon": "⭐",
      "title": "Мотивационное: 300 ответов",
      "description": "Дано 300 правильных ответов (глобально)",
      "chat_id": "global",
      "chat_title": "Глобальные"
    }
  ]
}
```

---

## 🎨 ОТОБРАЖЕНИЕ В ВЕБ-ПАНЕЛИ

### Местоположение
**Раздел:** Пользователи → Клик по пользователю → Модальное окно

### Дизайн карточки достижения

```
┌─────────────────────────────────────────────────┐
│ 🔥 │ Серия: 15 подряд              │ [ СЕРИЯ ] │
│    │ Серия из 15 правильных ответов подряд      │
│    │ 📍 Название чата                            │
└─────────────────────────────────────────────────┘
     ↑         ↑                         ↑
   Иконка   Описание                   Тип
```

### Цветовая схема

| Тип | Цвет границы | Цвет бейджа | Иконка |
|-----|--------------|-------------|--------|
| Серия (streak) | Оранжевый | Оранжевый | 🔥 |
| Чат (chat) | Зеленый | Зеленый | 🏆 |
| Мотивационное | Синий | Синий | ⭐ |
| Неизвестное | Серый | Серый | 🎖️ |

### Сортировка
Достижения отсортированы:
1. По типу: Серия → Чат → Мотивационное
2. По количеству: От большего к меньшему

---

## 🔧 КАК РАБОТАЕТ ДЕКОДИРОВАНИЕ

### Функция `decode_achievement()` в `web/main.py`

```python
def decode_achievement(achievement_id: str) -> Dict[str, Any]:
    """Декодирует ID достижения в человеко-читаемый формат"""
    
    # chat_achievement_{chat_id}_{user_id}_{score}
    if achievement_id.startswith("chat_achievement_"):
        parts = achievement_id.split("_")
        score = parts[-1]
        return {
            "type": "chat",
            "icon": "🏆",
            "title": f"Достижение чата: {score} очков",
            "description": f"Набрано {score} баллов в чате"
        }
    
    # motivational_{chat_id}_{user_id}_{count}
    elif achievement_id.startswith("motivational_"):
        parts = achievement_id.split("_")
        count = parts[-1]
        is_global = len(parts) == 3
        return {
            "type": "motivational",
            "icon": "⭐",
            "title": f"Мотивационное: {count} ответов",
            "description": f"Дано {count} правильных ответов" + 
                           (" (глобально)" if is_global else " (в чате)")
        }
    
    # Неизвестный тип
    return {
        "type": "unknown",
        "icon": "🎖️",
        "title": "Достижение",
        "description": achievement_id
    }
```

---

## 📱 ПРИМЕР ОТОБРАЖЕНИЯ

### Модальное окно пользователя с ачивками:

```
┌─────────────────────────────────────────────────────┐
│ 👤 Анна                                       [×]  │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 🏅 Достижения [17]                                 │
│                                                     │
│ ┌─────────────────────────────────────────┐        │
│ │ 🔥 │ Серия: 15 подряд      │ СЕРИЯ  │         │
│ │    │ Серия из 15 правильных...        │         │
│ │    │ 📍 Тест викторина                │         │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ ┌─────────────────────────────────────────┐        │
│ │ 🏆 │ Достижение: 1000 очков│ ЧАТ    │         │
│ │    │ Набрано 1000 баллов в чате       │         │
│ │    │ 📍 Тест викторина                │         │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ ┌─────────────────────────────────────────┐        │
│ │ ⭐ │ Мотивационное: 300    │ МОТИВ. │         │
│ │    │ Дано 300 правильных ответов      │         │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ ... еще 14 достижений                               │
│                                                     │
│ 📊 Статистика                                       │
│ ├─ Отвечено опросов: 498                            │
│ ├─ Средний балл: 3.34                               │
│ └─ Серия (макс.): 🔥 15                             │
│                                                     │
│ 💬 Активность по чатам (1)                          │
│ ...                                                 │
│                                                     │
│ [Закрыть]                                           │
└─────────────────────────────────────────────────────┘
```

### Если нет достижений:

```
┌─────────────────────────────────────────────────────┐
│ 🏅 Достижения [0]                                   │
│                                                     │
│        🏅                                           │
│   Пока нет достижений                               │
│   Ответь на вопросы, чтобы получить ачивки!         │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## ✨ ОСОБЕННОСТИ РЕАЛИЗАЦИИ

### 1. Объединение ачивок из разных источников
- Собираются из каждого чата (`data/chats/{chat_id}/users.json`)
- Добавляются глобальные (`data/global/users.json`)
- Избегается дублирование

### 2. Отображение источника ачивки
- Каждая ачивка показывает, в каком чате она получена
- Глобальные ачивки помечены как "Глобальные"

### 3. Адаптивный дизайн
- Список прокручивается при большом количестве ачивок (макс. высота 300px)
- Карточки адаптируются под размер экрана

### 4. Цветовое кодирование
- Каждый тип ачивки имеет свой цвет для быстрого распознавания
- Граница и бейдж используют один цвет

---

## 📅 Дата создания
2026-01-01

## 🔧 Дата последнего обновления
2026-01-01 - Добавлено отображение достижений пользователей в веб-панели
