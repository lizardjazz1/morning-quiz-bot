# üöÄ –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Morning Quiz Bot

## üìã –û–±–∑–æ—Ä

–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** –∏ **–∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö**. –ö–∞–∂–¥—ã–π —á–∞—Ç –∏–º–µ–µ—Ç —Å–≤–æ—é –ø–∞–ø–∫—É —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏, –∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

**‚úÖ –í–ê–ñ–ù–û: –ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –í–°–Ø —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –¥–∞–∂–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è!**

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
data/
‚îú‚îÄ‚îÄ chats/                          # –î–∞–Ω–Ω—ã–µ –ø–æ —á–∞—Ç–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ 621817842/                 # ID —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.json          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.json             # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —á–∞—Ç–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stats.json             # –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ -1002123346533/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stats.json
‚îÇ   ‚îî‚îÄ‚îÄ -4239123712/
‚îÇ       ‚îú‚îÄ‚îÄ settings.json
‚îÇ       ‚îú‚îÄ‚îÄ users.json
‚îÇ       ‚îî‚îÄ‚îÄ stats.json
‚îú‚îÄ‚îÄ global/                         # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ users.json                 # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ categories.json            # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ chats_index.json           # –ò–Ω–¥–µ–∫—Å –≤—Å–µ—Ö —á–∞—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ system_stats.json          # –°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ statistics/                     # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ global_stats.json          # –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
‚îÇ   ‚îú‚îÄ‚îÄ categories_stats.json      # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
‚îÇ   ‚îî‚îÄ‚îÄ migration_report.json      # –û—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ system/                         # –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ daily_quiz_subscriptions.json
‚îÇ   ‚îú‚îÄ‚îÄ messages_to_delete.json
‚îÇ   ‚îî‚îÄ‚îÄ malformed_questions.json
‚îî‚îÄ‚îÄ questions/                      # –í–æ–ø—Ä–æ—Å—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    ‚îú‚îÄ‚îÄ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞.json
    ‚îú‚îÄ‚îÄ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è.json
    ‚îú‚îÄ‚îÄ –ò—Å—Ç–æ—Ä–∏—è.json
    ‚îú‚îÄ‚îÄ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ.json
    ‚îî‚îÄ‚îÄ ...
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### **1. –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–¥–Ω–∏–º —á–∞—Ç–æ–º –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
- ‚úÖ –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∫–∞–∂–¥—ã–π —á–∞—Ç –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

### **2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å –Ω—É–∂–Ω—ã–º —Ñ–∞–π–ª–æ–º
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —á–∞—Ç—ã

### **3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏**
- ‚úÖ –¢–æ—á–µ—á–Ω—ã–µ –±—ç–∫–∞–ø—ã: —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —á–∞—Ç
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏: –ª–µ–≥–∫–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏

### **4. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –û—Ç–ª–∞–¥–∫–∞: –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —á–∞—Ç
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∞—Ç–∞–º

### **5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** ‚≠ê
- ‚úÖ **–í–°–Ø —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**
- ‚úÖ **–°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ **MD5 —Ö–µ—à–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤**

## üîß –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**
```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
python migrate_data_structure.py
```

### **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:**
1. **–°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è** –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–ú–∏–≥—Ä–∏—Ä—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–æ–≤** –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏
3. **–ú–∏–≥—Ä–∏—Ä—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
4. **–ú–∏–≥—Ä–∏—Ä—É—é—Ç –≤–æ–ø—Ä–æ—Å—ã** –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
5. **–°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞
6. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** –º–∏–≥—Ä–∞—Ü–∏–∏
7. **–°–æ–∑–¥–∞—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

### **–†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**
1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
3. –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —á–∞—Å—Ç—è–º
4. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

## üìù –§–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤

### **settings.json (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞)**
```json
{
  "default_quiz_type": "session",
  "default_num_questions": 10,
  "default_open_period_seconds": 60,
  "daily_quiz": {
    "enabled": true,
    "times_msk": [{"hour": 8, "minute": 0}],
    "categories_mode": "random"
  }
}
```

### **users.json (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—Ç–∞)**
```json
{
  "621817842": {
    "name": "Ilya",
    "score": 6.0,
    "answered_polls": ["poll_id_1", "poll_id_2"],
    "first_answer_time": "2025-08-01T17:51:38+00:00",
    "last_answer_time": "2025-08-24T14:36:05+00:00",
    "milestones_achieved": []
  }
}
```

### **stats.json (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞)** ‚≠ê –ù–û–í–´–ô –§–ê–ô–õ
```json
{
  "chat_id": "621817842",
  "total_users": 50,
  "total_score": 150.5,
  "total_answered_polls": 300,
  "average_score": 3.01,
  "average_answered_per_user": 6.0,
  "user_activity": {
    "621817842": {
      "name": "Ilya",
      "answered_count": 35,
      "score": 6.0,
      "first_answer": "2025-08-01T17:51:38+00:00",
      "last_answer": "2025-08-24T14:36:05+00:00"
    }
  },
  "score_distribution": {
    "0-1": 5,
    "1-3": 15,
    "3-5": 20,
    "5-10": 8,
    "10+": 2
  },
  "top_users": [...],
  "most_active_users": [...],
  "migration_date": "2025-01-27T10:00:00+00:00"
}
```

### **global_stats.json (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)** ‚≠ê –ù–û–í–´–ô –§–ê–ô–õ
```json
{
  "total_users": 150,
  "active_users": 120,
  "inactive_users": 30,
  "total_score": 450.5,
  "total_answered_polls": 1200,
  "average_score": 3.0,
  "average_answered_per_user": 8.0,
  "score_distribution": {
    "0-1": 10,
    "1-5": 40,
    "5-10": 60,
    "10-25": 25,
    "25-50": 10,
    "50+": 5
  },
  "top_users": [...],
  "most_active_users": [...],
  "migration_date": "2025-01-27T10:00:00+00:00"
}
```

### **categories.json (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)**
```json
{
  "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞": {
    "question_count": 50,
    "file_path": "questions/–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞.json",
    "last_updated": "2025-01-27T10:00:00+00:00",
    "file_size": 15420,
    "checksum": "a1b2c3d4e5f6..."
  }
}
```

### **categories_stats.json (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)** ‚≠ê –ù–û–í–´–ô –§–ê–ô–õ
```json
{
  "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞": {
    "question_count": 50,
    "question_types": {
      "multiple_choice": 30,
      "true_false": 20
    },
    "difficulty_levels": {
      "easy": 15,
      "medium": 25,
      "hard": 10
    },
    "average_options_per_question": 4.0,
    "migration_date": "2025-01-27T10:00:00+00:00"
  }
}
```

### **chats_index.json (–∏–Ω–¥–µ–∫—Å —á–∞—Ç–æ–≤)**
```json
{
  "621817842": {
    "settings_file": "chats/621817842/settings.json",
    "users_file": "chats/621817842/users.json",
    "stats_file": "chats/621817842/stats.json",
    "has_settings": true,
    "has_users": true,
    "has_stats": true,
    "migration_date": "2025-01-27T10:00:00+00:00"
  }
}
```

### **migration_info.json (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∏–≥—Ä–∞—Ü–∏–∏)** ‚≠ê –ù–û–í–´–ô –§–ê–ô–õ
```json
{
  "migration_date": "2025-01-27T10:00:00+00:00",
  "source_structure": "legacy_single_files",
  "target_structure": "organized_by_chats",
  "total_chats": 3,
  "backup_location": "data/backup_before_migration",
  "checksum_verification": true,
  "statistics_preserved": true
}
```

## üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

### **1. DataManager**
```python
class DataManager:
    def __init__(self, data_dir: str = "data"):
        self.data_dir = Path(data_dir)
        self.chats_dir = self.data_dir / "chats"
        self.global_dir = self.data_dir / "global"
        self.questions_dir = self.data_dir / "questions"
        self.statistics_dir = self.data_dir / "statistics"
    
    def get_chat_settings(self, chat_id: int) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞"""
        settings_file = self.chats_dir / str(chat_id) / "settings.json"
        if settings_file.exists():
            with open(settings_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
    
    def get_chat_statistics(self, chat_id: int) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞"""
        stats_file = self.chats_dir / str(chat_id) / "stats.json"
        if stats_file.exists():
            with open(stats_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
    
    def get_global_statistics(self) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"""
        stats_file = self.statistics_dir / "global_stats.json"
        if stats_file.exists():
            with open(stats_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
    
    def update_chat_setting(self, chat_id: int, key_path: List[str], value: Any) -> bool:
        """–û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞"""
        chat_dir = self.chats_dir / str(chat_id)
        chat_dir.mkdir(parents=True, exist_ok=True)
        
        settings_file = chat_dir / "settings.json"
        settings = self.get_chat_settings(chat_id)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –ø—É—Ç–∏
        current = settings
        for key in key_path[:-1]:
            if key not in current:
                current[key] = {}
            current = current[key]
        current[key_path[-1]] = value
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º
        with open(settings_file, 'w', encoding='utf-8') as f:
            json.dump(settings, f, ensure_ascii=False, indent=2)
        
        return True
```

### **2. CategoryManager**
```python
class CategoryManager:
    def __init__(self, questions_dir: str = "data/questions"):
        self.questions_dir = Path(questions_dir)
        self.categories_cache = {}
    
    def get_category_questions(self, category_name: str) -> List[Dict[str, Any]]:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
        if category_name in self.categories_cache:
            return self.categories_cache[category_name]
        
        category_file = self.questions_dir / f"{category_name}.json"
        if category_file.exists():
            with open(category_file, 'r', encoding='utf-8') as f:
                questions = json.load(f)
                self.categories_cache[category_name] = questions
                return questions
        return []
    
    def get_all_category_names(self) -> List[str]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π"""
        return [f.stem for f in self.questions_dir.glob("*.json")]
    
    def get_category_statistics(self) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"""
        stats_file = Path("data/statistics/categories_stats.json")
        if stats_file.exists():
            with open(stats_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
```

### **3. ScoreManager**
```python
class ScoreManager:
    def __init__(self, data_dir: str = "data"):
        self.data_dir = Path(data_dir)
        self.chats_dir = self.data_dir / "chats"
        self.global_dir = self.data_dir / "global"
        self.statistics_dir = self.data_dir / "statistics"
    
    def get_chat_rating(self, chat_id: int, top_n: int = 10) -> List[Dict[str, Any]]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞"""
        users_file = self.chats_dir / str(chat_id) / "users.json"
        if not users_file.exists():
            return []
        
        with open(users_file, 'r', encoding='utf-8') as f:
            users = json.load(f)
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—á–∫–∞–º
        sorted_users = sorted(users.items(), key=lambda x: x[1].get('score', 0), reverse=True)
        return [{"user_id": uid, **data} for uid, data in sorted_users[:top_n]]
    
    def get_global_rating(self, top_n: int = 10) -> List[Dict[str, Any]]:
        """–ü–æ–ª—É—á–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥"""
        global_users_file = self.global_dir / "users.json"
        if not global_users_file.exists():
            return []
        
        with open(global_users_file, 'r', encoding='utf-8') as f:
            global_users = json.load(f)
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–º –æ—á–∫–∞–º
        sorted_users = sorted(global_users.items(), key=lambda x: x[1].get('global_score', 0), reverse=True)
        return [{"user_id": uid, **data} for uid, data in sorted_users[:top_n]]
    
    def get_chat_statistics(self, chat_id: int) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞"""
        stats_file = self.chats_dir / str(chat_id) / "stats.json"
        if stats_file.exists():
            with open(stats_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
    
    def get_global_statistics(self) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"""
        stats_file = self.statistics_dir / "global_stats.json"
        if stats_file.exists():
            with open(stats_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### **–°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
```json
{
  "total_chats": 3,
  "total_users": 150,
  "total_questions": 1800,
  "total_categories": 25,
  "last_backup": "2025-01-27T10:00:00+00:00",
  "disk_usage": {
    "chats": "15KB",
    "global": "5KB",
    "questions": "491KB",
    "statistics": "10KB",
    "total": "521KB"
  }
}
```

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞**
```json
{
  "total_users": 50,
  "total_questions_asked": 150,
  "average_score": 4.2,
  "most_active_category": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
  "last_quiz_date": "2025-01-27",
  "daily_quiz_enabled": true
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –±—ç–∫–∞–ø—ã

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã**
- –ö–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø
- –•—Ä–∞–Ω–∏—Ç—Å—è 7 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤
- –°–∂–∞—Ç–∏–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞

### **–¢–æ—á–µ—á–Ω—ã–µ –±—ç–∫–∞–ø—ã**
```bash
# –ë—ç–∫–∞–ø –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞
python backup_chat.py 621817842

# –ë—ç–∫–∞–ø –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
python backup_category.py "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
python restore_chat.py 621817842 backup_20250127.zip
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** ‚≠ê –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø
- MD5 —Ö–µ—à–∏ –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## üöÄ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –æ–±—É—á–µ–Ω–∏–µ

### **–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤)**
- üîÑ –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
- üîÑ API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- üîÑ –†–µ–∞–ª-—Ç–∞–π–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (6+ –º–µ—Å—è—Ü–µ–≤)**
- üîÆ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- üîÆ –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- üîÆ –®–∞—Ä–¥–∏–Ω–≥ –ø–æ —á–∞—Ç–∞–º
- üîÆ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –±–æ—Ç–∞ –∏ —Å–∏—Å—Ç–µ–º—ã
2. **–°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø** –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ—Ç–∫–∞—Ç–∞** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### **–ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- ‚úÖ **–í–°–Ø —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**
- ‚úÖ **–°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è**
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å**
- ‚úÖ **–ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è**

### **–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π**
- üîç **–õ–µ–≥—á–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ**
- üöÄ **–õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- üõ°Ô∏è **–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**

---

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö!

**‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –Ω–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –í–°–Ø —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏ –¥–∞–∂–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∞!
