<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Quiz Bot</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- Puter.js for Claude API -->
    <script src="https://js.puter.com/v2/"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/modals.css">
    <link rel="stylesheet" href="/static/css/components.css">
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>
    
    <div class="mobile-header">
        <button class="burger-button" id="mobileMenuToggle" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">
            ‚ò∞
        </button>
        <div class="mobile-header-title">üéØ Quiz –ê–¥–º–∏–Ω–∫–∞</div>
    </div>
    
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üéØ Quiz –ê–¥–º–∏–Ω–∫–∞</div>
            </div>
            
            <nav class="sidebar-nav">
                <a class="nav-item active" data-section="dashboard">
                    <span class="nav-icon">üìä</span>
                    –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                </a>
                <a class="nav-item" data-section="questions">
                    <span class="nav-icon">‚ùì</span>
                    –í–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                </a>
                <a class="nav-item" data-section="malformed-questions">
                    <span class="nav-icon">‚ö†Ô∏è</span>
                    –ë—Ä–∞–∫–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                </a>
                <a class="nav-item" data-section="bot-metrics">
                    <span class="nav-icon">üìä</span>
                    –ú–µ—Ç—Ä–∏–∫–∏ –±–æ—Ç–∞
                </a>
                <a class="nav-item" data-section="photo-quiz">
                    <span class="nav-icon">üñºÔ∏è</span>
                    –§–æ—Ç–æ-–≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
                </a>
                <a class="nav-item" data-section="analytics">
                    <span class="nav-icon">üìà</span>
                    –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                </a>
                <a class="nav-item" data-section="users">
                    <span class="nav-icon">üë•</span>
                    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </a>
                <a class="nav-item" data-section="chats">
                    <span class="nav-icon">üí¨</span>
                    –ß–∞—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏
                </a>
                <a class="nav-item" data-section="claude-ai">
                    <span class="nav-icon">ü§ñ</span>
                    Claude AI
                </a>
                <a class="nav-item" data-section="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="content-header">
                    <h1 class="page-title">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                    <div class="header-actions">
                        <div class="dark-mode-toggle" id="darkModeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"></div>
                        <button class="btn btn-primary" onclick="refreshDashboard()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <!-- System Status -->
                <div class="card" style="margin-bottom: 1.5rem; padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span id="botStatusIcon" style="font-size: 1.5rem;">‚ö™</span>
                            <div>
                                <div style="font-weight: 600; font-size: 1rem;">–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);" id="botStatusText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-secondary" onclick="showSection('settings')">
                                ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card" style="cursor: pointer;" onclick="showSection('users')" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                <div class="kpi-value" id="totalUsers">-</div>
                                <div class="kpi-change positive">
                                    <span>‚Üë</span> –ê–∫—Ç–∏–≤–Ω—ã
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;" id="avgActivityUsers">-</div>
                            </div>
                            <div class="kpi-icon primary">üë•</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card" style="cursor: pointer;" onclick="showSection('analytics')" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤</div>
                                <div class="kpi-value" id="totalQuizzes">-</div>
                                <div class="kpi-change positive">
                                    <span>‚Üë</span> –ó–∞–ø—É—â–µ–Ω–æ
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;" id="avgAnswered">-</div>
                            </div>
                            <div class="kpi-icon success">üéØ</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card" style="cursor: pointer;" onclick="showSection('questions')" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–ë–∞–∑–∞ –≤–æ–ø—Ä–æ—Å–æ–≤</div>
                                <div class="kpi-value" id="totalQuestionsDB">-</div>
                                <div class="kpi-change">
                                    <span>üìö</span> –î–æ—Å—Ç—É–ø–Ω–æ
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;" id="categoriesInfo">-</div>
                            </div>
                            <div class="kpi-icon info">‚ùì</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–û–±—â–∏–π —Å—á—ë—Ç</div>
                                <div class="kpi-value" id="totalScore" style="font-size: 1.5rem;">-</div>
                                <div class="kpi-change">
                                    <span>üèÜ</span> –ë–∞–ª–ª–æ–≤
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;" id="avgScore">-</div>
                            </div>
                            <div class="kpi-icon warning" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üèÜ</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card" style="cursor: pointer;" onclick="showSection('chats')" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —á–∞—Ç–æ–≤">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã</div>
                                <div class="kpi-value" id="totalChats">-</div>
                                <div class="kpi-change positive">
                                    <span>‚Üë</span> –ü–æ–¥–∫–ª—é—á–µ–Ω–æ
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;" id="activeSubscriptions">-</div>
                            </div>
                            <div class="kpi-icon danger">üí¨</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card" style="cursor: pointer;" onclick="showSection('photo-quiz')" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ-–≤–∏–∫—Ç–æ—Ä–∏–Ω">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–§–æ—Ç–æ-–≤–∏–∫—Ç–æ—Ä–∏–Ω—ã</div>
                                <div class="kpi-value" id="totalPhotoQuiz">-</div>
                                <div class="kpi-change">
                                    <span>üñºÔ∏è</span> –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</div>
                            </div>
                            <div class="kpi-icon secondary">üì∏</div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="card" style="margin-top: 1.5rem; margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem; font-size: 1rem;">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                        <button class="btn btn-primary btn-sm" onclick="showSection('questions'); addNewQuestion();">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                        </button>
                        <button class="btn btn-success btn-sm" onclick="showSection('photo-quiz'); addNewPhotoQuiz();">
                            üñºÔ∏è –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
                        </button>
                        <button class="btn btn-info btn-sm" onclick="showSection('analytics'); window.open('/api/export/statistics', '_blank');">
                            üì• –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="showSection('chats')">
                            üí¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="showSection('users')">
                            üë• –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        </button>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                            <p class="chart-subtitle">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</p>
                        </div>
                        <div class="chart-container">
                            <canvas id="activityChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h3>
                            <p class="chart-subtitle">–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</p>
                        </div>
                        <div class="chart-container">
                            <canvas id="categoriesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">–õ–∏–¥–µ—Ä—ã</h3>
                            <p class="chart-subtitle">–ü–æ –æ–±—â–µ–º—É —Å—á–µ—Ç—É</p>
                        </div>
                        <div class="chart-container">
                            <canvas id="usersChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤</h3>
                            <p class="chart-subtitle">–°–µ–≥–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                        </div>
                        <div class="chart-container">
                            <canvas id="scoreDistChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Questions Section -->
            <section id="questions" class="section">
                <div class="content-header">
                    <h1 class="page-title">–í–æ–ø—Ä–æ—Å—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadQuestions()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                        <button class="btn btn-primary" onclick="addNewQuestion()">
                            <span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                        </button>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 250px 1fr; gap: 1.5rem;">
                    <!-- Categories Sidebar -->
                    <div class="card" style="height: fit-content;">
                        <h3 style="margin-bottom: 1rem; font-size: 1rem;">üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                        <div id="categoriesList" style="overflow-y: auto;">
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        </div>
                    </div>
                    
                    <!-- Questions Content -->
                    <div class="card">
                        <div class="search-box">
                            <input type="text" id="questionSearch" class="form-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º..." oninput="filterQuestions()">
                        </div>
                        
                        <div id="currentCategoryInfo" style="margin-bottom: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px; display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span style="font-weight: 600; color: var(--text-primary);" id="currentCategoryName"></span>
                                    <span style="color: var(--text-secondary); font-size: 0.875rem; margin-left: 0.5rem;" id="currentCategoryCount"></span>
                                </div>
                                <button class="btn btn-secondary" onclick="showAllQuestions()" style="padding: 0.375rem 0.75rem; font-size: 0.75rem;">
                                    ‚úï –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
                                </button>
                            </div>
                        </div>
                        
                        <div id="questionsContainer">
                            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤...</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Malformed Questions Section -->
            <section id="malformed-questions" class="section">
                <div class="content-header">
                    <h1 class="page-title">‚ö†Ô∏è –ë—Ä–∞–∫–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadMalformedQuestions()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 0.5rem 0; font-size: 1rem;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.875rem;" id="malformedStats">
                                –ó–∞–≥—Ä—É–∑–∫–∞...
                            </p>
                        </div>
                    </div>
                </div>
                
                <div id="malformedQuestionsContainer">
                    <p style="text-align: center; padding: 2rem;">–ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–∞–∫–æ–≤–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤...</p>
                </div>
            </section>
            
            <!-- Bot Metrics Section -->
            <section id="bot-metrics" class="section">
                <div class="content-header">
                    <h1 class="page-title">üìä –ú–µ—Ç—Ä–∏–∫–∏ –±–æ—Ç–∞</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadBotMetrics()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <!-- –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem; font-size: 1rem;">–°—Ç–∞—Ç—É—Å –±–æ—Ç–∞</h3>
                    <div id="botMetricsStatus" style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                        <p style="text-align: center; color: var(--text-secondary);">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
                
                <!-- –ú–µ—Ç—Ä–∏–∫–∏ -->
                <div class="kpi-grid" style="margin-bottom: 1.5rem;">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–û—à–∏–±–∫–∏ —Ç–∞–π–º–∞—É—Ç–∞</div>
                                <div class="kpi-value" id="timeoutErrors">-</div>
                                <div class="kpi-change">
                                    <span>‚ö†Ô∏è</span> –í—Å–µ–≥–æ
                                </div>
                            </div>
                            <div class="kpi-icon danger">‚è±Ô∏è</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏</div>
                                <div class="kpi-value" id="retryAttempts">-</div>
                                <div class="kpi-change">
                                    <span>üîÑ</span> –í—Å–µ–≥–æ
                                </div>
                            </div>
                            <div class="kpi-icon warning">üîÑ</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">Uptime</div>
                                <div class="kpi-value" id="botUptime" style="font-size: 1.2rem;">-</div>
                                <div class="kpi-change">
                                    <span>‚è∞</span> –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
                                </div>
                            </div>
                            <div class="kpi-icon success">‚è∞</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-label">–ü—Ä–æ—Ü–µ—Å—Å</div>
                                <div class="kpi-value" id="botProcess" style="font-size: 1.2rem;">-</div>
                                <div class="kpi-change">
                                    <span>üñ•Ô∏è</span> PID
                                </div>
                            </div>
                            <div class="kpi-icon info">üñ•Ô∏è</div>
                        </div>
                    </div>
                </div>
                
                <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="card">
                    <h3 style="margin-bottom: 1rem; font-size: 1rem;">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <div id="botMetricsDetails" style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                        <p style="text-align: center; color: var(--text-secondary);">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
            </section>
            
            <!-- Photo Quiz Section -->
            <section id="photo-quiz" class="section">
                <div class="content-header">
                    <h1 class="page-title">–§–æ—Ç–æ-–≤–∏–∫—Ç–æ—Ä–∏–Ω—ã</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadPhotoQuiz()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                        <button class="btn btn-primary" onclick="addNewPhotoQuiz()">
                            <span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
                        </button>
                    </div>
                </div>
                <div id="photoQuizContainer">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ-–≤–∏–∫—Ç–æ—Ä–∏–Ω...</p>
                </div>
            </section>
            
            <!-- Analytics Section -->
            <section id="analytics" class="section">
                <div class="content-header">
                    <h1 class="page-title">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadAnalytics()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                        <button class="btn btn-primary" onclick="window.open('/api/export/statistics', '_blank')">
                            <span>üì•</span> –≠–∫—Å–ø–æ—Ä—Ç
                        </button>
                    </div>
                </div>
                
                <div id="analyticsContainer">
                    <p style="text-align: center; padding: 2rem;">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...</p>
                </div>
            </section>
            
            <!-- Users Section -->
            <section id="users" class="section">
                <div class="content-header">
                    <h1 class="page-title">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadUsers()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                        <button class="btn btn-primary" onclick="window.open('/api/export/statistics', '_blank')">
                            <span>üì•</span> –≠–∫—Å–ø–æ—Ä—Ç
                        </button>
                    </div>
                </div>
                
                <div id="usersContainer">
                    <p style="text-align: center; padding: 2rem;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
                </div>
            </section>
            
            <!-- Chats Section -->
            <section id="chats" class="section">
                <div class="content-header">
                    <h1 class="page-title">–ß–∞—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadChats()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <div id="chatsContainer">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤...</p>
                </div>
            </section>
            
            <!-- Claude AI Section -->
            <section id="claude-ai" class="section">
                <div class="content-header">
                    <h1 class="page-title">ü§ñ Claude AI Assistant</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="clearClaudeChat()">
                            <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="form-group">
                        <label class="form-label">–ü—Ä–æ–≤–∞–π–¥–µ—Ä API</label>
                        <select id="claudeProvider" class="form-select" onchange="onProviderChange()">
                            <option value="puter" selected>Puter.js (–ë–µ—Å–ø–ª–∞—Ç–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é)</option>
                            <option value="anthropic">Anthropic API (–¢—Ä–µ–±—É–µ—Ç API –∫–ª—é—á)</option>
                            <option value="openrouter">OpenRouter (–¢—Ä–µ–±—É–µ—Ç API –∫–ª—é—á, –µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)</option>
                        </select>
                    </div>
                    
                    <div id="apiKeyGroup" class="form-group" style="display: none;">
                        <label class="form-label">API –ö–ª—é—á</label>
                        <input 
                            type="password" 
                            id="claudeApiKey" 
                            class="form-input" 
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á..."
                            style="font-family: monospace; font-size: 0.875rem;"
                        >
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            <div id="apiKeyHint"></div>
                            <div style="margin-top: 0.25rem;">
                                üíæ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage)
                            </div>
                        </div>
                    </div>
                    
                    <div id="puterStatus" style="padding: 0.75rem; margin-bottom: 1rem; border-radius: 6px; background: var(--bg-secondary); display: none;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span id="puterStatusIcon">‚è≥</span>
                            <span id="puterStatusText" style="font-size: 0.875rem;">–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Puter.js...</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ú–æ–¥–µ–ª—å Claude</label>
                        <select id="claudeModel" class="form-select">
                            <option value="claude-sonnet-4-5" selected>Claude Sonnet 4.5 (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                            <option value="claude-opus-4-5">Claude Opus 4.5 (–ú–æ—â–Ω–∞—è)</option>
                            <option value="claude-haiku-4-5">Claude Haiku 4.5 (–ë—ã—Å—Ç—Ä–∞—è)</option>
                            <option value="claude-sonnet-4">Claude Sonnet 4</option>
                            <option value="claude-opus-4">Claude Opus 4</option>
                            <option value="claude-opus-4-1">Claude Opus 4.1</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="claudeStreamMode" checked style="margin-right: 0.5rem;">
                            –†–µ–∂–∏–º —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –ø–æ –º–µ—Ä–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
                        </label>
                    </div>
                    
                    <div id="maxTokensGroup" class="form-group" style="display: none;">
                        <label class="form-label">–ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ (max_tokens)</label>
                        <input 
                            type="number" 
                            id="claudeMaxTokens" 
                            class="form-input" 
                            value="2048"
                            min="1"
                            max="32000"
                            step="256"
                            placeholder="2048"
                        >
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            üí° –ú–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ = –º–µ–Ω—å—à–µ —Ä–∞—Å—Ö–æ–¥ –∫—Ä–µ–¥–∏—Ç–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 1024-4096
                        </div>
                    </div>
                    
                    <div id="providerInfo" style="padding: 0.75rem; background: rgba(79, 195, 247, 0.1); border-radius: 6px; margin-top: 1rem;">
                        <div style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.5;">
                            <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
                            <span id="providerInfoText">Puter.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å "User-Pays" - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API. –î–ª—è —Ä–∞–±–æ—Ç—ã –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ <a href="https://puter.com" target="_blank" style="color: #4fc3f7;">puter.com</a>.</span>
                        </div>
                    </div>
                    
                    <div id="russiaInfo" style="padding: 0.75rem; background: rgba(251, 191, 36, 0.1); border-radius: 6px; margin-top: 0.75rem; border-left: 3px solid #fbbf24; display: none;">
                        <div style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.5;">
                            <strong>üá∑üá∫ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Puter.js –∏–∑ –†–æ—Å—Å–∏–∏:</strong><br>
                            <div style="margin-top: 0.5rem;">
                                <strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:</strong>
                                <ul style="margin: 0.5rem 0; padding-left: 1.5rem; font-size: 0.8125rem;">
                                    <li>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑-–∑–∞ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</li>
                                    <li>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ DNS/IP</li>
                                    <li>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ –†–æ—Å—Å–∏–∏</li>
                                </ul>
                            </div>
                            <div style="margin-top: 0.5rem;">
                                <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong>
                                <ul style="margin: 0.5rem 0; padding-left: 1.5rem; font-size: 0.8125rem;">
                                    <li><strong>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Anthropic API –∏–ª–∏ OpenRouter</strong> —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</li>
                                    <li>–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –∏–º–µ–Ω–Ω–æ Puter.js: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN –∏–∑ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–π —Å—Ç—Ä–∞–Ω—ã</li>
                                    <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å Puter –Ω–∞ —Å–≤–æ–µ–º VPS –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π</li>
                                    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ DNS-—Ä–µ–∑–æ–ª–≤–µ—Ä—ã (Cloudflare, Google)</li>
                                </ul>
                            </div>
                            <div style="margin-top: 0.5rem; font-size: 0.75rem; opacity: 0.8;">
                                ‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VPN –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–§. 
                                –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ API (Anthropic, OpenRouter) —Å –≤–∞—à–∏–º –∫–ª—é—á–æ–º.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div id="claudeChatContainer" style="min-height: 400px; max-height: 600px; overflow-y: auto; padding: 1rem; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 1rem;">
                        <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ü§ñ</div>
                            <div>–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å Claude AI</div>
                            <div style="font-size: 0.875rem; margin-top: 0.5rem; opacity: 0.7;">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–º–æ—á—å —Å —á–µ–º-–ª–∏–±–æ</div>
                        </div>
                    </div>
                    
                    <div id="claudeFilesContainer" style="margin-bottom: 0.75rem; display: none;">
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;" id="claudeFilesList"></div>
                    </div>
                    
                    <div style="display: flex; gap: 0.75rem;">
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 0.5rem;">
                            <textarea 
                                id="claudeInput" 
                                class="form-textarea" 
                                rows="3" 
                                placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∑–∞–ø—Ä–æ—Å..."
                                style="resize: vertical;"
                                onkeydown="handleClaudeInputKeydown(event)"
                            ></textarea>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label for="claudeFileInput" class="btn btn-secondary" style="margin: 0; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem;">
                                    <span>üìé</span> –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª
                                </label>
                                <input 
                                    type="file" 
                                    id="claudeFileInput" 
                                    multiple 
                                    accept="image/*,.txt,.pdf,.doc,.docx,.csv,.json,.xml,.md,.py,.js,.html,.css"
                                    style="display: none;"
                                    onchange="handleFileUpload(event)"
                                >
                                <div style="font-size: 0.75rem; color: var(--text-secondary); flex: 1;">
                                    üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, Shift+Enter –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
                                </div>
                            </div>
                        </div>
                        <button 
                            class="btn btn-primary" 
                            onclick="sendClaudeMessage()"
                            id="claudeSendBtn"
                            style="align-self: flex-end; padding: 0.75rem 1.5rem;"
                        >
                            <span>üì§</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Modals -->
            <div id="modalContainer"></div>
            
            <!-- Settings Section -->
            <section id="settings" class="section">
                <div class="content-header">
                    <h1 class="page-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadSettings()">
                            <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <div id="settingsContainer">
                    <p style="text-align: center; padding: 2rem;">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫...</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal: Chat Schedule -->
    <div id="chatScheduleModal" class="modal-overlay" onclick="if(event.target.id === 'chatScheduleModal') closeModal('chatScheduleModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</h3>
                <button class="modal-close-btn" onclick="closeModal('chatScheduleModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form onsubmit="event.preventDefault(); saveChatSchedule();">
                    <div class="form-group">
                        <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px;">
                            <input type="checkbox" id="editDailyQuizEnabled" style="width: 20px; height: 20px; cursor: pointer;">
                            <label for="editDailyQuizEnabled" style="margin: 0; cursor: pointer; font-weight: 500;">–í–∫–ª—é—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‚è∞ –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ (–ú–°–ö)</label>
                        <div id="dailyQuizTimesContainer" style="max-height: 200px; overflow-y: auto; margin-bottom: 0.5rem;">
                            <!-- –í—Ä–µ–º–µ–Ω–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                        <button type="button" class="btn-add-item" onclick="addDailyQuizTime()" style="width: 100%;">+ –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è</button>
                        <p class="form-hint">–í–∏–∫—Ç–æ—Ä–∏–Ω—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('chatScheduleModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveChatSchedule()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Modal: Add/Edit Question -->
    <div id="addQuestionModal" class="modal-overlay" onclick="if(event.target.id === 'addQuestionModal') closeModal('addQuestionModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title" id="addQuestionModalTitle">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</h3>
                <button class="modal-close-btn" onclick="closeModal('addQuestionModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form onsubmit="event.preventDefault(); saveQuestion();">
                    <div class="form-group">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                        <select id="addQuestionCategory" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–í–æ–ø—Ä–æ—Å *</label>
                        <textarea id="addQuestionText" class="form-textarea" rows="2" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ *</label>
                        <div id="addQuestionOptionsContainer" style="max-height: 200px; overflow-y: auto; margin-bottom: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                            <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                        <button type="button" class="btn-add-item" onclick="addOptionInput(document.getElementById('addQuestionOptionsContainer'))" style="width: 100%; padding: 0.5rem; font-size: 0.875rem;">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç *</label>
                        <select id="addCorrectAnswer" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                        <div>
                            <label class="form-label">–ü–æ—è—Å–Ω–µ–Ω–∏–µ</label>
                            <textarea id="addExplanation" class="form-textarea" rows="2" placeholder="–û–±—ä—è—Å–Ω–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
                        </div>
                        <div>
                            <label class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                            <select id="addDifficulty" class="form-select">
                                <option value="easy">–õ–µ–≥–∫–∞—è</option>
                                <option value="medium" selected>–°—Ä–µ–¥–Ω—è—è</option>
                                <option value="hard">–°–ª–æ–∂–Ω–∞—è</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addQuestionModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveQuestion()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/static/js/app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ select –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const categorySelect = document.getElementById('addQuestionCategory');
            if (categorySelect && allCategories) {
                allCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    categorySelect.appendChild(option);
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞
            const optionsContainer = document.getElementById('addQuestionOptionsContainer');
            if (optionsContainer) {
                addOptionInput(optionsContainer, '', false);
                addOptionInput(optionsContainer, '', false);
            }
        });
        
        // ========== Claude AI Functions ==========
        let claudeChatHistory = [];
        let claudeAttachedFiles = []; // –ú–∞—Å—Å–∏–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        function handleClaudeInputKeydown(event) {
            // Enter –±–µ–∑ Shift - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
                sendClaudeMessage();
            }
            // Shift+Enter –∏–ª–∏ Ctrl+Enter - –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
            // Enter —Å Shift - —Ä–∞–∑—Ä–µ—à–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É (–Ω–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º)
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            const filesContainer = document.getElementById('claudeFilesContainer');
            const filesList = document.getElementById('claudeFilesList');
            
            files.forEach(file => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    showToast(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å 10MB)`, 'error');
                    return;
                }
                
                const fileId = Date.now() + Math.random();
                const fileObj = {
                    id: fileId,
                    file: file,
                    name: file.name,
                    type: file.type,
                    size: file.size
                };
                
                claudeAttachedFiles.push(fileObj);
                
                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∞–π–ª–∞
                const fileElement = document.createElement('div');
                fileElement.id = `file-${fileId}`;
                fileElement.style.cssText = `
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem;
                    background: var(--bg-secondary);
                    border-radius: 6px;
                    font-size: 0.875rem;
                `;
                
                const fileIcon = file.type.startsWith('image/') ? 'üñºÔ∏è' : 
                                 file.type.includes('text') || file.name.endsWith('.md') ? 'üìÑ' : 
                                 file.type.includes('pdf') ? 'üìï' : 'üìé';
                
                fileElement.innerHTML = `
                    <span>${fileIcon}</span>
                    <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${file.name}</span>
                    <span style="color: var(--text-secondary); font-size: 0.75rem;">${formatFileSize(file.size)}</span>
                    <button onclick="removeFile('${fileId}')" style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 0.25rem; font-size: 1rem; line-height: 1;">√ó</button>
                `;
                
                filesList.appendChild(fileElement);
            });
            
            filesContainer.style.display = claudeAttachedFiles.length > 0 ? 'block' : 'none';
            
            // –û—á–∏—â–∞–µ–º input –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞ —Å–Ω–æ–≤–∞
            event.target.value = '';
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        function removeFile(fileId) {
            claudeAttachedFiles = claudeAttachedFiles.filter(f => f.id !== fileId);
            const fileElement = document.getElementById(`file-${fileId}`);
            if (fileElement) {
                fileElement.remove();
            }
            
            const filesContainer = document.getElementById('claudeFilesContainer');
            filesContainer.style.display = claudeAttachedFiles.length > 0 ? 'block' : 'none';
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ base64 –∏–ª–∏ —Ç–µ–∫—Å—Ç
        async function readFileForAPI(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                if (file.type.startsWith('image/')) {
                    // –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - base64
                    reader.onload = () => {
                        const base64 = reader.result.split(',')[1]; // –£–±–∏—Ä–∞–µ–º data:image/...;base64,
                        resolve({
                            type: 'image',
                            mimeType: file.type,
                            data: base64
                        });
                    };
                    reader.readAsDataURL(file);
                } else if (file.type.includes('text') || file.name.endsWith('.md') || 
                          file.name.endsWith('.json') || file.name.endsWith('.xml') ||
                          file.name.endsWith('.py') || file.name.endsWith('.js') ||
                          file.name.endsWith('.html') || file.name.endsWith('.css')) {
                    // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ - —á–∏—Ç–∞–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç
                    reader.onload = () => {
                        resolve({
                            type: 'text',
                            content: reader.result
                        });
                    };
                    reader.readAsText(file);
                } else {
                    // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ - base64
                    reader.onload = () => {
                        const base64 = reader.result.split(',')[1];
                        resolve({
                            type: 'base64',
                            mimeType: file.type || 'application/octet-stream',
                            data: base64
                        });
                    };
                    reader.readAsDataURL(file);
                }
                
                reader.onerror = reject;
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem('claude_api_key');
            const savedProvider = localStorage.getItem('claude_provider') || 'puter';
            const savedMaxTokens = localStorage.getItem('claude_max_tokens') || '2048';
            
            if (savedKey) {
                document.getElementById('claudeApiKey').value = savedKey;
            }
            
            const maxTokensInput = document.getElementById('claudeMaxTokens');
            if (maxTokensInput) {
                maxTokensInput.value = savedMaxTokens;
            }
            
            document.getElementById('claudeProvider').value = savedProvider;
            onProviderChange();
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
        function onProviderChange() {
            const provider = document.getElementById('claudeProvider').value;
            const apiKeyGroup = document.getElementById('apiKeyGroup');
            const apiKeyHint = document.getElementById('apiKeyHint');
            const providerInfoText = document.getElementById('providerInfoText');
            const puterStatus = document.getElementById('puterStatus');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
            localStorage.setItem('claude_provider', provider);
            
            if (provider === 'puter') {
                apiKeyGroup.style.display = 'none';
                puterStatus.style.display = 'block';
                document.getElementById('russiaInfo').style.display = 'block';
                providerInfoText.innerHTML = 'Puter.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å "User-Pays" - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API. <strong style="color: #ef4444;">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ. –ï—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Anthropic API –∏–ª–∏ OpenRouter —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º.';
                checkPuterAvailability();
            } else             if (provider === 'anthropic') {
                apiKeyGroup.style.display = 'block';
                puterStatus.style.display = 'none';
                document.getElementById('maxTokensGroup').style.display = 'none';
                apiKeyHint.innerHTML = '–ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –Ω–∞ <a href="https://console.anthropic.com/" target="_blank" style="color: #4fc3f7;">console.anthropic.com</a>';
                providerInfoText.innerHTML = 'Anthropic API - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API –æ—Ç —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π Claude. –¢—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ API –∫–ª—é—á. –ï—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.';
            } else if (provider === 'openrouter') {
                apiKeyGroup.style.display = 'block';
                puterStatus.style.display = 'none';
                document.getElementById('maxTokensGroup').style.display = 'block';
                document.getElementById('russiaInfo').style.display = 'none';
                apiKeyHint.innerHTML = '–ü–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API –∫–ª—é—á –Ω–∞ <a href="https://openrouter.ai/" target="_blank" style="color: #4fc3f7;">openrouter.ai</a> (–µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)';
                providerInfoText.innerHTML = 'OpenRouter - –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä —Ä–∞–∑–ª–∏—á–Ω—ã—Ö LLM API, –≤–∫–ª—é—á–∞—è Claude. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. <strong style="color: #ef4444;">‚ö†Ô∏è –°–ª–µ–¥–∏—Ç–µ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º –∫—Ä–µ–¥–∏—Ç–æ–≤!</strong>';
            } else {
                document.getElementById('maxTokensGroup').style.display = 'none';
                document.getElementById('russiaInfo').style.display = 'none';
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–∞ –∏ max_tokens
        document.addEventListener('DOMContentLoaded', () => {
            const apiKeyInput = document.getElementById('claudeApiKey');
            if (apiKeyInput) {
                apiKeyInput.addEventListener('blur', () => {
                    const key = apiKeyInput.value.trim();
                    if (key) {
                        localStorage.setItem('claude_api_key', key);
                    } else {
                        localStorage.removeItem('claude_api_key');
                    }
                });
            }
            
            const maxTokensInput = document.getElementById('claudeMaxTokens');
            if (maxTokensInput) {
                maxTokensInput.addEventListener('change', () => {
                    const value = maxTokensInput.value;
                    if (value) {
                        localStorage.setItem('claude_max_tokens', value);
                    }
                });
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Puter.js –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function checkPuterAvailability() {
            const statusDiv = document.getElementById('puterStatus');
            const statusIcon = document.getElementById('puterStatusIcon');
            const statusText = document.getElementById('puterStatusText');
            
            if (!statusDiv) return;
            
            statusDiv.style.display = 'block';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
            setTimeout(() => {
                if (typeof puter !== 'undefined' && puter.ai && typeof puter.ai.chat === 'function') {
                    statusIcon.textContent = '‚úÖ';
                    statusText.textContent = 'Puter.js –∑–∞–≥—Ä—É–∂–µ–Ω. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Claude API';
                    statusDiv.style.background = 'rgba(34, 197, 94, 0.1)';
                    statusDiv.style.border = '1px solid rgba(34, 197, 94, 0.3)';
                } else {
                    statusIcon.textContent = '‚è≥';
                    statusText.innerHTML = '–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ Puter.js... (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏)';
                    statusDiv.style.background = 'rgba(251, 191, 36, 0.1)';
                    statusDiv.style.border = '1px solid rgba(251, 191, 36, 0.3)';
                    
                    // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        if (typeof puter !== 'undefined' && puter.ai && typeof puter.ai.chat === 'function') {
                            statusIcon.textContent = '‚úÖ';
                            statusText.textContent = 'Puter.js –∑–∞–≥—Ä—É–∂–µ–Ω. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Claude API';
                            statusDiv.style.background = 'rgba(34, 197, 94, 0.1)';
                            statusDiv.style.border = '1px solid rgba(34, 197, 94, 0.3)';
                        } else {
                            statusIcon.textContent = '‚ö†Ô∏è';
                            statusText.innerHTML = 'Puter.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. <a href="https://puter.com" target="_blank" style="color: #4fc3f7;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</a> (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ)';
                            statusDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                            statusDiv.style.border = '1px solid rgba(239, 68, 68, 0.3)';
                        }
                    }, 2000);
                }
            }, 1500);
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', checkPuterAvailability);
        } else {
            setTimeout(checkPuterAvailability, 500);
        }
        
        async function sendClaudeMessage() {
            const input = document.getElementById('claudeInput');
            const message = input.value.trim();
            
            if (!message) {
                showToast('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error');
                return;
            }
            
            const provider = document.getElementById('claudeProvider').value;
            const model = document.getElementById('claudeModel').value;
            const streamMode = document.getElementById('claudeStreamMode').checked;
            const sendBtn = document.getElementById('claudeSendBtn');
            const chatContainer = document.getElementById('claudeChatContainer');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
            if (provider === 'anthropic' || provider === 'openrouter') {
                const apiKey = document.getElementById('claudeApiKey').value.trim();
                if (!apiKey) {
                    showToast('–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á', 'error');
                    addClaudeMessage('system', `‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω API –∫–ª—é—á –¥–ª—è ${provider === 'anthropic' ? 'Anthropic' : 'OpenRouter'}.\n\n–ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á:\n${provider === 'anthropic' ? '- https://console.anthropic.com/' : '- https://openrouter.ai/'}`);
                    return;
                }
            } else if (provider === 'puter') {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ Puter.js
                if (typeof puter === 'undefined' || !puter.ai) {
                    showToast('Puter.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.', 'error');
                    addClaudeMessage('system', '‚ö†Ô∏è Puter.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:\n1. –ï—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É\n2. –°–∫—Ä–∏–ø—Ç https://js.puter.com/v2/ –¥–æ—Å—Ç—É–ø–µ–Ω\n3. –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n\nüí° –°–æ–≤–µ—Ç: –ï—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Puter.js –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ Anthropic API –∏–ª–∏ OpenRouter —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º.');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
                try {
                    if (!puter.ai || typeof puter.ai.chat !== 'function') {
                        throw new Error('API Puter.js –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    }
                } catch (error) {
                    showToast('Puter.js API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –í–æ–∑–º–æ–∂–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.', 'error');
                    addClaudeMessage('system', '‚ö†Ô∏è Puter.js API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.\n\n–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:\n1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É\n2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É\n3. –í–æ–∑–º–æ–∂–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Puter.js\n\nüí° –ï—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Anthropic API –∏–ª–∏ OpenRouter —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º.');
                    return;
                }
            }
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span>‚è≥</span> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            input.disabled = true;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç (—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ñ–∞–π–ª–∞—Ö)
            let userMessage = message;
            if (claudeAttachedFiles.length > 0) {
                userMessage += `\n\n[–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: ${claudeAttachedFiles.length}]`;
            }
            addClaudeMessage('user', userMessage);
            input.value = '';
            
            // –û—á–∏—â–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            const initialMessage = chatContainer.querySelector('div[style*="text-align: center"]');
            if (initialMessage) {
                initialMessage.remove();
            }
            
            try {
                // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∞–π–ª—ã –¥–ª—è API
                let fileContents = [];
                if (claudeAttachedFiles.length > 0) {
                    try {
                        for (const fileObj of claudeAttachedFiles) {
                            const fileData = await readFileForAPI(fileObj.file);
                            fileContents.push(fileData);
                        }
                    } catch (fileError) {
                        showToast(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ${fileError.message}`, 'error');
                        sendBtn.disabled = false;
                        sendBtn.innerHTML = '<span>üì§</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å';
                        input.disabled = false;
                        input.focus();
                        return;
                    }
                }
                if (provider === 'puter') {
                    // Puter.js –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é
                    if (claudeAttachedFiles.length > 0) {
                        showToast('Puter.js –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Anthropic API –∏–ª–∏ OpenRouter.', 'error');
                        return;
                    }
                    if (streamMode) {
                        await streamClaudeResponse(message, model);
                    } else {
                        await getClaudeResponse(message, model);
                    }
                } else if (provider === 'anthropic') {
                    const apiKey = document.getElementById('claudeApiKey').value.trim();
                    if (streamMode) {
                        await streamAnthropicResponse(message, model, apiKey, fileContents);
                    } else {
                        await getAnthropicResponse(message, model, apiKey, fileContents);
                    }
                } else if (provider === 'openrouter') {
                    const apiKey = document.getElementById('claudeApiKey').value.trim();
                    if (streamMode) {
                        await streamOpenRouterResponse(message, model, apiKey, fileContents);
                    } else {
                        await getOpenRouterResponse(message, model, apiKey, fileContents);
                    }
                }
                
                // –û—á–∏—â–∞–µ–º —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                claudeAttachedFiles = [];
                const filesContainer = document.getElementById('claudeFilesContainer');
                const filesList = document.getElementById('claudeFilesList');
                filesList.innerHTML = '';
                filesContainer.style.display = 'none';
            } catch (error) {
                console.error('Claude API Error:', error);
                let errorMessage = error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Claude';
                
                // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
                if (errorMessage.includes('sign up') || errorMessage.includes('not allowed') || errorMessage.includes('authentication') || errorMessage.includes('sign in')) {
                    errorMessage = '‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Puter.js.\n\nPuter.js –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Anthropic API –∏–ª–∏ OpenRouter —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º\n2. –û—Ç–∫—Ä—ã—Ç—å https://puter.com –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ\n3. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ)\n4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN –∏–∑ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–π —Å—Ç—Ä–∞–Ω—ã';
                    addClaudeMessage('system', errorMessage);
                } else if (typeof puter === 'undefined' || !puter.ai) {
                    errorMessage = '‚ö†Ô∏è Puter.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω.\n\n–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:\n1. –ï—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É\n2. –°–∫—Ä–∏–ø—Ç https://js.puter.com/v2/ –¥–æ—Å—Ç—É–ø–µ–Ω\n3. –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n4. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É\n\nüí° –ò–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ Anthropic API –∏–ª–∏ OpenRouter';
                    addClaudeMessage('system', errorMessage);
                } else {
                    addClaudeMessage('assistant', `‚ùå –û—à–∏–±–∫–∞: ${errorMessage}`);
                }
                
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Claude API', 'error');
            } finally {
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ–±—Ä–∞—Ç–Ω–æ
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<span>üì§</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å';
                input.disabled = false;
                input.focus();
            }
        }
        
        async function streamClaudeResponse(message, model) {
            const chatContainer = document.getElementById('claudeChatContainer');
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–≤–µ—Ç–∞
            const messageDiv = document.createElement('div');
            messageDiv.className = 'claude-message assistant';
            messageDiv.innerHTML = `
                <div class="claude-message-header">
                    <strong>ü§ñ Claude</strong>
                    <span class="claude-model-badge">${model}</span>
                </div>
                <div class="claude-message-content" id="claudeStreamingContent"></div>
            `;
            chatContainer.appendChild(messageDiv);
            
            const contentDiv = document.getElementById('claudeStreamingContent');
            let fullResponse = '';
            
            // –ü—Ä–æ—Å—Ç–æ–π –≤—ã–∑–æ–≤ –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –æ—Ç Perplexity
            const response = await puter.ai.chat(message, { model: model, stream: true });
            
                for await (const part of response) {
                    if (part?.text) {
                        fullResponse += part.text;
                        contentDiv.innerHTML = parseMarkdown(fullResponse);
                        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }
                }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            claudeChatHistory.push({ role: 'user', content: message });
            claudeChatHistory.push({ role: 'assistant', content: fullResponse });
            
            // –£–±–∏—Ä–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π ID
            contentDiv.removeAttribute('id');
        }
        
        async function getClaudeResponse(message, model) {
            const chatContainer = document.getElementById('claudeChatContainer');
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–≤–µ—Ç–∞ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∑–∞–≥—Ä—É–∑–∫–∏
            const messageDiv = document.createElement('div');
            messageDiv.className = 'claude-message assistant';
            messageDiv.innerHTML = `
                <div class="claude-message-header">
                    <strong>ü§ñ Claude</strong>
                    <span class="claude-model-badge">${model}</span>
                </div>
                <div class="claude-message-content">
                    <span style="opacity: 0.5;">‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞...</span>
                </div>
            `;
            chatContainer.appendChild(messageDiv);
            
            const contentDiv = messageDiv.querySelector('.claude-message-content');
            
            // –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ API –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ Perplexity
            // puter.ai.chat("message", {model: 'claude-sonnet-4-5'})
            const response = await puter.ai.chat(message, { model: model });
            
            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ: response.message.content[0].text
            const responseText = response.message.content[0].text;
            contentDiv.innerHTML = parseMarkdown(responseText);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            claudeChatHistory.push({ role: 'user', content: message });
            claudeChatHistory.push({ role: 'assistant', content: responseText });
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // ========== Anthropic API Functions ==========
        // –°–æ–∑–¥–∞–Ω–∏–µ content –º–∞—Å—Å–∏–≤–∞ –¥–ª—è Anthropic API —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–∞–π–ª–æ–≤
        function createAnthropicContent(message, fileContents) {
            const content = [];
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (message.trim()) {
                content.push({ type: 'text', text: message });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã
            for (const fileData of fileContents) {
                if (fileData.type === 'image') {
                    content.push({
                        type: 'image',
                        source: {
                            type: 'base64',
                            media_type: fileData.mimeType,
                            data: fileData.data
                        }
                    });
                } else if (fileData.type === 'text') {
                    // –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç
                    content.push({ 
                        type: 'text', 
                        text: `\n\n[–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞]:\n${fileData.content}` 
                    });
                } else {
                    // –î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã –∫–∞–∫ base64 (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
                    content.push({
                        type: 'text',
                        text: `\n\n[–§–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64, MIME: ${fileData.mimeType}]`
                    });
                }
            }
            
            return content;
        }
        
        async function streamAnthropicResponse(message, model, apiKey, fileContents = []) {
            const chatContainer = document.getElementById('claudeChatContainer');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'claude-message assistant';
            messageDiv.innerHTML = `
                <div class="claude-message-header">
                    <strong>ü§ñ Claude (Anthropic)</strong>
                    <span class="claude-model-badge">${model}</span>
                </div>
                <div class="claude-message-content" id="anthropicStreamingContent"></div>
            `;
            chatContainer.appendChild(messageDiv);
            
            const contentDiv = document.getElementById('anthropicStreamingContent');
            let fullResponse = '';
            
            try {
                // –ú–∞–ø–ø–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π –¥–ª—è Anthropic API
                const anthropicModel = model.replace('claude-', '').replace('-4-5', '-4.5').replace('-4-1', '-4.1');
                
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: `claude-${anthropicModel}`,
                        max_tokens: 4096,
                        messages: [{ 
                            role: 'user', 
                            content: createAnthropicContent(message, fileContents)
                        }],
                        stream: true
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || '–û—à–∏–±–∫–∞ Anthropic API');
                }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n').filter(line => line.trim() !== '');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            
                            try {
                                const parsed = JSON.parse(data);
                                if (parsed.type === 'content_block_delta' && parsed.delta?.text) {
                                    fullResponse += parsed.delta.text;
                                    contentDiv.innerHTML = parseMarkdown(fullResponse);
                                    chatContainer.scrollTop = chatContainer.scrollHeight;
                                }
                            } catch (e) {
                                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
                            }
                        }
                    }
                }
                
                claudeChatHistory.push({ role: 'user', content: message });
                claudeChatHistory.push({ role: 'assistant', content: fullResponse });
                contentDiv.removeAttribute('id');
                
            } catch (error) {
                contentDiv.innerHTML = `<span style="color: var(--danger);">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
                throw error;
            }
        }
        
        async function getAnthropicResponse(message, model, apiKey, fileContents = []) {
            const chatContainer = document.getElementById('claudeChatContainer');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'claude-message assistant';
            messageDiv.innerHTML = `
                <div class="claude-message-header">
                    <strong>ü§ñ Claude (Anthropic)</strong>
                    <span class="claude-model-badge">${model}</span>
                </div>
                <div class="claude-message-content">
                    <span style="opacity: 0.5;">‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞...</span>
                </div>
            `;
            chatContainer.appendChild(messageDiv);
            
            const contentDiv = messageDiv.querySelector('.claude-message-content');
            
            try {
                const anthropicModel = model.replace('claude-', '').replace('-4-5', '-4.5').replace('-4-1', '-4.1');
                
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: `claude-${anthropicModel}`,
                        max_tokens: 4096,
                        messages: [{ 
                            role: 'user', 
                            content: createAnthropicContent(message, fileContents)
                        }]
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || '–û—à–∏–±–∫–∞ Anthropic API');
                }
                
                const data = await response.json();
                const responseText = data.content[0].text;
                
                contentDiv.innerHTML = parseMarkdown(responseText);
                claudeChatHistory.push({ role: 'user', content: message });
                claudeChatHistory.push({ role: 'assistant', content: responseText });
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
            } catch (error) {
                contentDiv.innerHTML = `<span style="color: var(--danger);">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
                throw error;
            }
        }
        
        // ========== OpenRouter API Functions ==========
        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ID –º–æ–¥–µ–ª–∏ –≤ —Ñ–æ—Ä–º–∞—Ç OpenRouter
        // OpenRouter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç: anthropic/claude-{model-name}
        // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://openrouter.ai/anthropic/claude-sonnet-4.5
        // –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:
        //   claude-sonnet-4-5 -> anthropic/claude-sonnet-4.5
        //   claude-opus-4-5 -> anthropic/claude-opus-4.5
        //   claude-haiku-4-5 -> anthropic/claude-haiku-4.5
        //   claude-opus-4-1 -> anthropic/claude-opus-4.1
        //   claude-sonnet-4 -> anthropic/claude-sonnet-4
        function mapModelToOpenRouter(modelId) {
            // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å claude- –µ—Å–ª–∏ –µ—Å—Ç—å
            let modelName = modelId.replace(/^claude-/, '');
            
            // –ó–∞–º–µ–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ—Ñ–∏—Å –º–µ–∂–¥—É —Ü–∏—Ñ—Ä–∞–º–∏ –Ω–∞ —Ç–æ—á–∫—É (4-5 -> 4.5, 4-1 -> 4.1)
            // –ü–∞—Ç—Ç–µ—Ä–Ω: -(\d+)-(\d+)$ –æ–∑–Ω–∞—á–∞–µ—Ç –¥–µ—Ñ–∏—Å-—Ü–∏—Ñ—Ä–∞-–¥–µ—Ñ–∏—Å-—Ü–∏—Ñ—Ä–∞ –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏
            // –≠—Ç–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤–µ—Ä—Å–∏–∏ —Ç–∏–ø–∞ "4-5" –≤ "4.5" –∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç OpenRouter
            modelName = modelName.replace(/-(\d+)-(\d+)$/, '-$1.$2');
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenRouter: anthropic/claude-{model-name}
            return `anthropic/claude-${modelName}`;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ content –º–∞—Å—Å–∏–≤–∞ –¥–ª—è OpenRouter API —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–∞–π–ª–æ–≤
        function createOpenRouterContent(message, fileContents) {
            const content = [];
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (message.trim()) {
                content.push({ type: 'text', text: message });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã (OpenRouter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç, —á—Ç–æ –∏ Anthropic)
            for (const fileData of fileContents) {
                if (fileData.type === 'image') {
                    content.push({
                        type: 'image_url',
                        image_url: {
                            url: `data:${fileData.mimeType};base64,${fileData.data}`
                        }
                    });
                } else if (fileData.type === 'text') {
                    content.push({ 
                        type: 'text', 
                        text: `\n\n[–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞]:\n${fileData.content}` 
                    });
                } else {
                    content.push({
                        type: 'text',
                        text: `\n\n[–§–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64, MIME: ${fileData.mimeType}]`
                    });
                }
            }
            
            return content;
        }
        
        async function streamOpenRouterResponse(message, model, apiKey, fileContents = []) {
            const chatContainer = document.getElementById('claudeChatContainer');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'claude-message assistant';
            messageDiv.innerHTML = `
                <div class="claude-message-header">
                    <strong>ü§ñ Claude (OpenRouter)</strong>
                    <span class="claude-model-badge">${model}</span>
                </div>
                <div class="claude-message-content" id="openrouterStreamingContent"></div>
            `;
            chatContainer.appendChild(messageDiv);
            
            const contentDiv = document.getElementById('openrouterStreamingContent');
            let fullResponse = '';
            
            try {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ID –º–æ–¥–µ–ª–∏ –≤ —Ñ–æ—Ä–º–∞—Ç OpenRouter
                const openRouterModel = mapModelToOpenRouter(model);
                
                // –ü–æ–ª—É—á–∞–µ–º max_tokens –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                const maxTokensInput = document.getElementById('claudeMaxTokens');
                const maxTokens = maxTokensInput ? parseInt(maxTokensInput.value) || 2048 : 2048;
                
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'Quiz Bot Admin'
                    },
                    body: JSON.stringify({
                        model: openRouterModel,
                        messages: [{ 
                            role: 'user', 
                            content: createOpenRouterContent(message, fileContents)
                        }],
                        max_tokens: maxTokens, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        stream: true
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    let errorMessage = error.error?.message || '–û—à–∏–±–∫–∞ OpenRouter API';
                    
                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
                    if (errorMessage.includes('credits') || errorMessage.includes('afford')) {
                        errorMessage = `üí≥ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ OpenRouter.\n\n${errorMessage}\n\n–†–µ—à–µ–Ω–∏—è:\n1. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ https://openrouter.ai/settings/credits\n2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)\n3. –£–º–µ–Ω—å—à–∏—Ç–µ max_tokens –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (—Ç–µ–∫—É—â–µ–µ: 2048)`;
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n').filter(line => line.trim() !== '');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            
                            try {
                                const parsed = JSON.parse(data);
                                if (parsed.choices?.[0]?.delta?.content) {
                                    fullResponse += parsed.choices[0].delta.content;
                                    contentDiv.innerHTML = parseMarkdown(fullResponse);
                                    chatContainer.scrollTop = chatContainer.scrollHeight;
                                }
                            } catch (e) {
                                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
                            }
                        }
                    }
                }
                
                claudeChatHistory.push({ role: 'user', content: message });
                claudeChatHistory.push({ role: 'assistant', content: fullResponse });
                contentDiv.removeAttribute('id');
                
            } catch (error) {
                contentDiv.innerHTML = `<span style="color: var(--danger);">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
                throw error;
            }
        }
        
        async function getOpenRouterResponse(message, model, apiKey, fileContents = []) {
            const chatContainer = document.getElementById('claudeChatContainer');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'claude-message assistant';
            messageDiv.innerHTML = `
                <div class="claude-message-header">
                    <strong>ü§ñ Claude (OpenRouter)</strong>
                    <span class="claude-model-badge">${model}</span>
                </div>
                <div class="claude-message-content">
                    <span style="opacity: 0.5;">‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞...</span>
                </div>
            `;
            chatContainer.appendChild(messageDiv);
            
            const contentDiv = messageDiv.querySelector('.claude-message-content');
            
            try {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ID –º–æ–¥–µ–ª–∏ –≤ —Ñ–æ—Ä–º–∞—Ç OpenRouter
                const openRouterModel = mapModelToOpenRouter(model);
                
                // –ü–æ–ª—É—á–∞–µ–º max_tokens –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                const maxTokensInput = document.getElementById('claudeMaxTokens');
                const maxTokens = maxTokensInput ? parseInt(maxTokensInput.value) || 2048 : 2048;
                
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'Quiz Bot Admin'
                    },
                    body: JSON.stringify({
                        model: openRouterModel,
                        messages: [{ 
                            role: 'user', 
                            content: createOpenRouterContent(message, fileContents)
                        }],
                        max_tokens: maxTokens // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    let errorMessage = error.error?.message || '–û—à–∏–±–∫–∞ OpenRouter API';
                    
                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
                    if (errorMessage.includes('credits') || errorMessage.includes('afford')) {
                        errorMessage = `üí≥ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ OpenRouter.\n\n${errorMessage}\n\n–†–µ—à–µ–Ω–∏—è:\n1. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ https://openrouter.ai/settings/credits\n2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)\n3. –£–º–µ–Ω—å—à–∏—Ç–µ max_tokens –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (—Ç–µ–∫—É—â–µ–µ: 2048)`;
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                const responseText = data.choices[0].message.content;
                
                contentDiv.innerHTML = parseMarkdown(responseText);
                claudeChatHistory.push({ role: 'user', content: message });
                claudeChatHistory.push({ role: 'assistant', content: responseText });
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
            } catch (error) {
                contentDiv.innerHTML = `<span style="color: var(--danger);">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
                throw error;
            }
        }
        
        function addClaudeMessage(role, content) {
            const chatContainer = document.getElementById('claudeChatContainer');
            
            // –û—á–∏—â–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            const initialMessage = chatContainer.querySelector('div[style*="text-align: center"]');
            if (initialMessage) {
                initialMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `claude-message ${role}`;
            
            if (role === 'user') {
                // –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º markdown, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–¥
                messageDiv.innerHTML = `
                    <div class="claude-message-header">
                        <strong>üë§ –í—ã</strong>
                    </div>
                    <div class="claude-message-content markdown-content">${parseMarkdown(content)}</div>
                `;
            } else if (role === 'system') {
                messageDiv.innerHTML = `
                    <div class="claude-message-header">
                        <strong>‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞</strong>
                    </div>
                    <div class="claude-message-content" style="white-space: pre-wrap;">${escapeHtml(content)}</div>
                `;
            } else {
                // –î–ª—è –æ—Ç–≤–µ—Ç–æ–≤ Claude –∏—Å–ø–æ–ª—å–∑—É–µ–º markdown —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
                messageDiv.innerHTML = `
                    <div class="claude-message-header">
                        <strong>ü§ñ Claude</strong>
                    </div>
                    <div class="claude-message-content markdown-content">${parseMarkdown(content)}</div>
                `;
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function clearClaudeChat() {
            const chatContainer = document.getElementById('claudeChatContainer');
            chatContainer.innerHTML = `
                <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ü§ñ</div>
                    <div>–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å Claude AI</div>
                    <div style="font-size: 0.875rem; margin-top: 0.5rem; opacity: 0.7;">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–º–æ—á—å —Å —á–µ–º-–ª–∏–±–æ</div>
                </div>
            `;
            claudeChatHistory = [];
            claudeAttachedFiles = [];
            
            // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
            const filesContainer = document.getElementById('claudeFilesContainer');
            const filesList = document.getElementById('claudeFilesList');
            if (filesList) {
                filesList.innerHTML = '';
            }
            if (filesContainer) {
                filesContainer.style.display = 'none';
            }
            
            showToast('–ß–∞—Ç –æ—á–∏—â–µ–Ω', 'success');
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // –ü–∞—Ä—Å–∏–Ω–≥ markdown —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞
        function parseMarkdown(text) {
            if (!text) return '';
            
            // –°–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–ª–æ–∫–∏ –∫–æ–¥–∞, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –±—ã–ª–∏ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã –¥—Ä—É–≥–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
            const codeBlocks = [];
            let codeBlockIndex = 0;
            
            // –ó–∞–º–µ–Ω—è–µ–º –±–ª–æ–∫–∏ –∫–æ–¥–∞ –Ω–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
            let processedText = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                const language = lang || 'text';
                const codeId = 'code-' + Date.now() + '-' + codeBlockIndex + '-' + Math.random().toString(36).substr(2, 9);
                codeBlockIndex++;
                
                const escapedCode = escapeHtml(code.trim());
                codeBlocks.push({
                    placeholder: `__CODE_BLOCK_${codeBlockIndex - 1}__`,
                    html: `
                        <div class="code-block-container">
                            <div class="code-block-header">
                                <span class="code-language">${language}</span>
                                <button class="code-copy-btn" onclick="copyCode('${codeId}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥">
                                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </div>
                            <pre class="code-block"><code id="${codeId}">${escapedCode}</code></pre>
                        </div>
                    `
                });
                
                return `__CODE_BLOCK_${codeBlockIndex - 1}__`;
            });
            
            // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML
            let html = escapeHtml(processedText);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–ª–æ–∫–∏ –∫–æ–¥–∞
            codeBlocks.forEach(block => {
                html = html.replace(block.placeholder, block.html);
            });
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–Ω–ª–∞–π–Ω –∫–æ–¥ —Å –æ–¥–∏–Ω–∞—Ä–Ω—ã–º–∏ –æ–±—Ä–∞—Ç–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏ (–Ω–æ –Ω–µ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞)
            html = html.replace(/`([^`\n]+)`/g, '<code class="inline-code">$1</code>');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç **—Ç–µ–∫—Å—Ç** (–Ω–æ –Ω–µ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞)
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫—É—Ä—Å–∏–≤ *—Ç–µ–∫—Å—Ç* (–Ω–æ –Ω–µ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞)
            html = html.replace(/(?<!<code[^>]*>)(?<!`)\*([^*\n]+)\*(?!`)(?!<\/code>)/g, '<em>$1</em>');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ [—Ç–µ–∫—Å—Ç](url)
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ (—Ç–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏)
            html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
            html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
            html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
            html = html.replace(/^\* (.+)$/gm, '<li>$1</li>');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
            html = html.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
            
            // –û–±–µ—Ä—Ç—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ <li> –≤ <ul>
            html = html.replace(/(<li>.*?<\/li>(?:\s*<li>.*?<\/li>)*)/gs, '<ul>$1</ul>');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ (–Ω–æ –Ω–µ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞)
            html = html.replace(/\n/g, '<br>');
            
            return html;
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyCode(codeId) {
            const codeElement = document.getElementById(codeId);
            if (!codeElement) return;
            
            const text = codeElement.textContent;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    const btn = codeElement.closest('.code-block-container').querySelector('.code-copy-btn');
                    const originalText = btn.textContent;
                    btn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
                    btn.style.background = 'rgba(34, 197, 94, 0.2)';
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = '';
                    }, 2000);
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                    showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏', 'error');
                });
            } else {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    showToast('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                } catch (err) {
                    showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏', 'error');
                }
                
                document.body.removeChild(textarea);
            }
        }
    </script>
    
    <style>
        /* Claude AI Chat Styles */
        .claude-message {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-radius: 8px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
        }
        
        .claude-message.user {
            background: rgba(79, 195, 247, 0.1);
            border-left: 3px solid #4fc3f7;
        }
        
        .claude-message.assistant {
            background: rgba(186, 104, 200, 0.1);
            border-left: 3px solid #ba68c8;
        }
        
        .claude-message.system {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
        }
        
        .claude-message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .claude-model-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            background: var(--bg-secondary);
            border-radius: 4px;
            opacity: 0.7;
        }
        
        .claude-message-content {
            color: var(--text-primary);
            line-height: 1.6;
            word-wrap: break-word;
        }
        
        .claude-message-content.markdown-content {
            white-space: normal;
        }
        
        /* –ë–ª–æ–∫–∏ –∫–æ–¥–∞ */
        .code-block-container {
            margin: 1rem 0;
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }
        
        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid var(--border-color);
        }
        
        .code-language {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .code-copy-btn {
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid rgba(79, 195, 247, 0.3);
            color: #4fc3f7;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .code-copy-btn:hover {
            background: rgba(79, 195, 247, 0.3);
            border-color: rgba(79, 195, 247, 0.5);
        }
        
        .code-block {
            margin: 0;
            padding: 1rem;
            overflow-x: auto;
            background: rgba(0, 0, 0, 0.3);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            color: #e0e0e0;
        }
        
        .code-block code {
            display: block;
            white-space: pre;
            word-wrap: normal;
            overflow-x: auto;
        }
        
        /* –ò–Ω–ª–∞–π–Ω –∫–æ–¥ */
        .inline-code {
            background: rgba(79, 195, 247, 0.15);
            color: #4fc3f7;
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        /* Markdown —ç–ª–µ–º–µ–Ω—Ç—ã */
        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3 {
            margin: 1rem 0 0.5rem 0;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .markdown-content h1 {
            font-size: 1.5rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        
        .markdown-content h2 {
            font-size: 1.25rem;
        }
        
        .markdown-content h3 {
            font-size: 1.1rem;
        }
        
        .markdown-content ul,
        .markdown-content ol {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        
        .markdown-content li {
            margin: 0.25rem 0;
        }
        
        .markdown-content a {
            color: #4fc3f7;
            text-decoration: none;
        }
        
        .markdown-content a:hover {
            text-decoration: underline;
        }
        
        .markdown-content strong {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .markdown-content em {
            font-style: italic;
        }
        
        #claudeChatContainer::-webkit-scrollbar {
            width: 8px;
        }
        
        #claudeChatContainer::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }
        
        #claudeChatContainer::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 4px;
        }
        
        #claudeChatContainer::-webkit-scrollbar-thumb:hover {
            background: var(--text-primary);
        }
    </style>
</body>
</html>
